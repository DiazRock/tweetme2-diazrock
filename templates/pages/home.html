{% extends '../tweets/base.html' %}



{% block content %}
<div class= 'row text-center' >
    <div class= 'col'>
        <h1>
            Welcome to Tweetme 2
        </h1>
    </div>
</div>


<div class= 'row'>
    <div class= 'col-md-4 mx-auto col-10'>
        <form class= 'form' method= 'POST' action='/create-tweet'>
            {% csrf_token %}
            <input type='hidden' value='/' name='next' />
            <textarea class= 'form-control' name= 'content' placeholder="Your tweet ..."></textarea>
            <button type='submit' class='btn btn-primary' >Tweet</button>
        </form>
    </div>
</div>


<div class="row" id='tweets'>
    Loading ...
</div>



<script>
    
    const tweetElement = document.getElementById("tweets")
    tweetElement.innerHTML = 'Loading ...'
    const xhr = new XMLHttpRequest()
    const method = 'GET'
    const url = "/tweets"
    const responseType = "json"

    function handleDidLike(tweet_id, currentCount) {
        console.log(tweet_id, currentCount)
    }

    function LikeBtn(tweet) {
        return "<button class= 'btn btn-primary' onclick= handleDidLike(" +
        tweet.id + "," + tweet.likes + ")>" + tweet.likes + " Like</button>"
    }

    function formatTweetElement(tweet) {
        const formattedTweet = "<div class='mb-4 col-md-10 mx-auto col-12 border rounded py-3' id= 'tweet-" 
        + tweet.id + "'>" 
        + "<p>" 
        + tweet.content
        + "</p><div class= 'btn-group'>" + LikeBtn(tweet) + "</div></div>"

        return formattedTweet
    }

    xhr.responseType = responseType
    xhr.open(method, url)
    xhr.onload = function () {
        const serverResponse = xhr.response
        const listedItems = serverResponse.response
        let finalTweetStr = ""
        let i
        for (i= 0; i< listedItems.length; i++ ){
            finalTweetStr += formatTweetElement(listedItems[i])
        }
        tweetElement.innerHTML = finalTweetStr
        console.log(listedItems)
    }
    xhr.send()
</script>

{% endblock content %}
    