{% extends '../tweets/base.html' %}



{% block content %}
Welcome to Tweetme 2

<div id='tweets'>
    Loading ...
</div>

<script>
    
    const tweetElement = document.getElementById("tweets")
    tweetElement.innerHTML = 'Loading ...'
    const xhr = new XMLHttpRequest()
    const method = 'GET'
    const url = "/tweets"
    const responseType = "json"

    function handleDidLike(tweet_id, currentCount) {
        console.log(tweet_id, currentCount)
    }

    function LikeBtn(tweet) {
        return "<button class= 'btn btn-primary' onclick= handleDidLike(tweet.id, tweet.likes)>Like</button>"
    }

    function formatTweetElement(tweet) {
        const formattedTweet = "<div class='mb-4' id= 'tweet-" 
        + tweet.id + "'>" 
        + "<p>" 
        + tweet.content
        + "</p><div class= 'btn-group'>" + LikeBtn(tweet) + "</div></div>"

        return formattedTweet
    }

    xhr.responseType = responseType
    xhr.open(method, url)
    xhr.onload = function () {
        const serverResponse = xhr.response
        const listedItems = serverResponse.response
        let finalTweetStr = ""
        let i
        for (i= 0; i< listedItems.length; i++ ){
            finalTweetStr += formatTweetElement(listedItems[i])
        }
        tweetElement.innerHTML = finalTweetStr
        console.log(listedItems)
    }
    xhr.send()
</script>

{% endblock content %}
    